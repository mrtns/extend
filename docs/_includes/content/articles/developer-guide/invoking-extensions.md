## Invoking Extensions

This section explains what you need to do when your platform reaches the point of processing when you need to invoke extension logic. 

In all instances, invocation of an extension occurs during an operation or transaction which makes the following parameters implicit: 

* **{webtask_container}**: name of the webtask container associated with the isolation scope (e.g. tenant) of the current operation or transactionas as determined in [Mapping Isolation Requirements onto Webtask Tokens](#mapping-isolation-requirements-onto-webtask-tokens). For example, if your scope of isolation is a tenant of your system, and you are processing a transaction on behalf of that tenant, the webtask container name of the extension to run is already known.

* **{extensibility_point_name}**: a unique name of the extensibility point type you want to invoke, e.g. "on-new-lead".

With this information, you can [discover](#discovering-extensions) if an extension is defined for a given extensibility point and isolation scope. The discovery process leads to the determination of the following two parameters, both of which are necessary to invoke the extension: 

* **{host_url}**: this is the url to the specific extension instance to call. 

* **{extension_secret}**: this is the value of the `auth0-extension-secret` metadata property you will need to authorize the call. 

**NOTE** invoking the discovery logic every time you need to execute an extension in your system may be impractical from performance perspective, depending on the frequency of extension execution. Consider applying caching mechanism to reduce the overhead of repeated Auth0 Extend management API calls related to discovery. 

In addition to the parameters above, you need a payload to supply to the extension, which you defined as part of [identifying the extensibility points in your platform](#identify-extensibility-points). 

Auth0 Extend supports creating extensions that leverage full flexibility of HTTP, including support for different verbs and content types. In the most common case of using JSON to submit payload to the extension, an invocation of the extension would look like this: 

```
POST {host_url}
Content-Type: application/json
Authorization: Bearer {extension_secret}

{payload}
```

A typical success response would have HTTP 200 status code and contain a JSON response body generated by the extension code. Your platform is reponsible for performing any necessary validation of the status code, and payload. 

[See invokeExtension function](https://github.com/auth0/extend/blob/master/samples/zerocrm/lib/extend.js#L68).  

The errors you may receive from calling Auth0 Extend extensions fall into several catergories and are described in [Handling Errors from Extensions](#handling-errors-from-extensions). 

One of the implementation decisions you need to make when invoking the extensions is related to their synchronous or asynchronous semantics, which you determined when [identifying the extensibility points in your platform](#identify-extensibility-points). 
When invoking synchronous extensions you must wait for the HTTPS request to complete before your platform can continue processing, because it has a dependency on the data the extension will respond with. In such cases you should consider enforcing a timeout on the overall duration of extension execution to ensure users of your platform have a good experience. 

When invoking asynchronous extensions, transaction processing in your platform will continue as soon as the HTTPS request to the invoke the extension has been issued. One consideration you should make in this case is related to handling of errors and output from asynchronous extensions. To aid in troubleshooting and monitoring, it may be reasonable to capture and log the outcome of asynchronous extension execution, even though it does not affect the processing of the transaction that triggered it. 
